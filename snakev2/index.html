<!DOCTYPE html>
<html>
    <head>
        <title>Snake</title>
        <style></style>
    </head>
    <body>
        <canvas id="scanvas", width="800", height="580", style="position:absolute;align-self: center;">Error</canvas>
        <script>
            var arkaplan_rengi = "#2C292A";
            var canvas = document.getElementById("scanvas");
            var ctx = canvas.getContext("2d");
            ctx.fillStyle = arkaplan_rengi;
            ctx.fillRect(0,0,800,580);

            document.addEventListener("keydown", KeyDown);
            document.addEventListener("touchstart", TouchStart);
            document.addEventListener("touchend", TouchEnd);

            var skor = 0;
            var hız = 20;
            var Hız = 10;
            var yılan = [
                [240,240],
                [260,240],
                [280,240]
            ]
            var elma = [null, null];
            var yılanS = 20;
            var yılanS = 20;
            var kare = [yılanS, yılanS];
            var yön = 1;
            var oynanıyor = false;
            var UpdateInt;

            var touchstartx;
            var touchstarty;

            function TouchStart(e){
                touchstartx = e.touches[0].clientX;
                touchstarty = e.touches[0].clientY;
            }

            function TouchEnd(e){
                if (!oynanıyor){
                    touchstartx = null;
                    touchstarty = null;
                    Baslat();
                }else{
                    if (!touchstartx || !touchstarty) return;
                    var touchendx = e.changedTouches[0].screenX;
                    var touchendy = e.changedTouches[0].screenY;
                    var diffX = touchendx - touchstartx;
                    var diffY = touchendy - touchstarty;
                    if (Math.abs(diffX) > Math.abs(diffY)){
                        if (diffX > 0){
                            YönDeğiş(1);
                        }else{
                            YönDeğiş(3);
                        }
                    }else{
                        if (diffY > 0){
                            YönDeğiş(2);
                        }else{
                            YönDeğiş(4);
                        }
                    }
                }
                e.preventDefault();
            }

            function KeyDown(e){
                key = e.key;
                if (!oynanıyor){
                    Baslat();
                }else{
                    if (key == "d" || key == "ArrowRight") YönDeğiş(1);
                    if (key == "s" || key == "ArrowDown") YönDeğiş(2);
                    if (key == "a" || key == "ArrowLeft") YönDeğiş(3);
                    if (key == "w" || key == "ArrowUp") YönDeğiş(4);
                }
            }
            
            function YönDeğiş(y){
                if (y==1 && yön !== 3) yön = 1;
                if (y==2 && yön !== 4) yön = 2;
                if (y==3 && yön !== 1) yön = 3;
                if (y==4 && yön !== 2) yön = 4;
            }

            function Baslat(){
                oynanıyor = true;
                UpdateInt = setInterval(() => {
                    Update();
                }, 1000/Hız);
                elmaKoy();
            }

            function yılanÇiz(){
                yılan.forEach(pos=>{
                    DikdörtgenÇiz(pos, kare, "#37BF1C")
                })
            }

            function elmaKoy(){
                var boşX = canvas.width/yılanS;
                var boşY = canvas.height/yılanS;
                var nX = Math.floor(Math.random()*boşX);
                var nY = Math.floor(Math.random()*boşY);
                elma = [nX*yılanS,nY*yılanS];
                var aynıKonum = false;
                yılan.forEach(pos=>{
                    if (pos[0] == elma[0] && pos[1] == elma[1]) aynıKonum = true;
                });
                if (aynıKonum) return elmaKoy();
                DikdörtgenÇiz(elma, kare, "#F73020")
            }

            function DikdörtgenÇiz(kord,byt,c){
                ctx.fillStyle = c;
                ctx.fillRect(kord[0],kord[1],byt[0],byt[1]);
            }
            function Update(){
                var shifted;
                var pushing;
                var yılankafa = yılan[yılan.length-1];
                switch (yön){
                case 1:
                    pushing = [yılankafa[0]+yılanS, yılankafa[1]]
                    break;
                case 2:
                    pushing = [yılankafa[0], yılankafa[1]+yılanS]
                    break;
                case 3:
                    pushing = [yılankafa[0]-yılanS, yılankafa[1]]
                    break;
                case 4:
                    pushing = [yılankafa[0], yılankafa[1]-yılanS]
                    break;
                }
                if (pushing[0]>canvas.width-yılanS) pushing[0] = 0;
                if (pushing[0]<0) pushing[0] = canvas.width-yılanS;
                if (pushing[1]>canvas.height-yılanS) pushing[1] = 0;
                if (pushing[1]<0) pushing[1] = canvas.height-yılanS;

                if (!(pushing[0] == elma[0] && pushing[1] == elma[1])){
                    shifted = yılan.shift();
                    DikdörtgenÇiz(shifted, kare, arkaplan_rengi)
                }else{
                    elmaKoy();
                    skor++;
                }
                yılan.push(pushing);
                yılanÇiz();
                Hız = 10 + skor/5;
            }
            
            yılanÇiz();
        </script>    
    </body>
</html>